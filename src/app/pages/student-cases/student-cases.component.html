<section class="flex w-full h-full flex-column">
    <div class="flex w-full h-full flex-column ">

        <div class="w-full h-4rem">
            <div class="grid h-full w-full">
                <div
                    class="col-4 flex align-items-center justify-content-center">

                </div>
                <div
                    class="col-4 flex align-items-center justify-content-center">
                    <h1> MIS CASOS</h1>

                </div>
                <div
                    class="col-4 flex align-items-center justify-content-center">
                    <p-button *ngIf="userRole ==='STUDENT'"
                        icon="pi pi-plus"
                        (onClick)="goToPage(['/generate-cases']);"
                        label="Generar caso" styleClass="p-button-success"></p-button>

                </div>
            </div>

        </div>
        <!-- <ng-container [ngSwitch]="userRole">
            <ng-container  *ngSwitchCase="'STUDENT'" [ngTemplateOutlet]="student"></ng-container>
            <ng-container  *ngSwitchCase="'PROFESSOR'" [ngTemplateOutlet]="professor"></ng-container>
            <ng-container  *ngSwitchCase="'VR'" [ngTemplateOutlet]="vr"></ng-container>
        </ng-container> -->
        <!-- <ng-template  #student
           >
           <div  class="h-full w-full  flex justify-content-center align-items-start">

               <p-table  [rowsPerPageOptions]="[5, 10, 15]" [rows]="5" [paginator]="true"  [value]="cases"
                   [tableStyle]="{ 'min-width': '50rem','width':'60rem'}">
                   <ng-template pTemplate="header">
                       <tr>
                           <th class="text-center"
                               style="background-color: #962330;color: white;">TÍTULO
                               DEL CASO</th>
                           <th class="text-center"
                               style="background-color: #962330;color: white;">ASIGNATURA</th>
                           <th class="text-center"
                               style="background-color: #962330;color: white;">FECHA
                               DE CREACIÓN</th>
                           <th class="text-center"
                               style="background-color: #962330;color: white;">CAMPUS</th>
                           <th class="text-center"
                               style="background-color: #962330;color: white;">ESTADO</th>
                           <th class="text-center"
                               style="background-color: #962330;color: white;">VER</th>
                       </tr>
                   </ng-template>
                   <ng-template pTemplate="body" let-cases>
                       <tr>
                           <td class="text-center">{{cases.title}}</td>
                           <td  class="text-center">{{(cases.nrc.name.length>5)? (cases.nrc.name | slice:0:10)+'...':(cases.nrc.name)}}</td>
                           <td class="text-center">{{cases.createdAt | date}}</td>
                           <td class="text-center">{{cases.campus.name}}</td>
                           <td *ngIf="cases.status=='UNSOLVED'" class="text-center">En
                               espera</td>
                           <td *ngIf="cases.status=='APPROVED'" class="text-center">Aprobado</td>
                           <td *ngIf="cases.status=='REJECTED'" class="text-center">Rechazado</td>
                           <td *ngIf="cases.status=='SOLVED'" class="text-center">Resuelto</td> 
                           <td class="text-center">
                               <p-button
                                   styleClass="p-button-rounded p-button-secondary p-button-text "
                                   icon="pi pi-eye" (onClick)="getCase(cases.id, 'VIEW')"></p-button>
                              
                               <p-button *ngIf="cases.status=='UNSOLVED' && userRole == 'VR'" 
                                   styleClass="p-button-rounded p-button-secondary p-button-text"
                                   icon="pi pi-pencil"
                                   (onClick)="getCase(cases.id, 'EDIT')"></p-button>
                               <p-button *ngIf="cases.status=='APPROVED' && userRole == 'PROFESSOR'" 
                                   styleClass="p-button-rounded p-button-secondary p-button-text"
                                   icon="pi pi-pencil"
                                   (onClick)="getCase(cases.id, 'EDIT')"></p-button>
                           </td>
   
                       </tr>
                   </ng-template>
                   <ng-template class="flex align-items-center justify-content-center" pTemplate="emptymessage" let-columns>
                               No hay casos
                   </ng-template>
               </p-table>
           </div>
        </ng-template > -->
        <!-- <ng-template  #vr
           >
           <div  class="h-full w-full  flex justify-content-center align-items-start">

            <p-table
            #dt2
            [value]="cases"
            dataKey="id"
            [rows]="10"
            [showCurrentPageReport]="true"
            [rowsPerPageOptions]="[10, 25, 50]"
            [loading]="loading"
            [paginator]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
            [globalFilterFields]="['name', 'country.name', 'representative.name', 'status']"
            [tableStyle]="{ 'min-width': '75rem' }"
            >
            <ng-template pTemplate="caption">
                <div class="flex">
                    <span class="p-input-icon-left ml-auto">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" (input)="dt2.filterGlobal($event.target.value, 'contains')" placeholder="Search keyword" />
                    </span>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                    <th style="width:22%">TITULO</th>
                    <th style="width:22%">ASIGNATURA</th>
                    <th style="width:22%">FECHA DE CREACIÓN</th>
                    <th style="width:22%">CAMPUS</th>
                    <th style="width:12%">ESTADO</th>
                    <th style="width:12%">VER</th>
                </tr>
                <tr>
                    <th>
                        <p-columnFilter type="text" field="name"></p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter type="text" field="country.name"></p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter field="representative" matchMode="in" [showMenu]="false">
                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                <p-multiSelect [ngModel]="value" [options]="representatives" placeholder="Any" (onChange)="filter($event.value)" optionLabel="name">
                                    <ng-template let-option pTemplate="item">
                                        <div class="inline-block vertical-align-middle">
                                            <img [alt]="option.label" src="https://primefaces.org/cdn/primeng/images/demo/avatar/{{ option.image }}" width="24" class="vertical-align-middle" />
                                            <span class="ml-1 mt-1">{{ option.name }}</span>
                                        </div>
                                    </ng-template>
                                </p-multiSelect>
                            </ng-template>
                        </p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter field="status" matchMode="equals" [showMenu]="false">
                            <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                <p-dropdown [ngModel]="value" [options]="statuses" (onChange)="filter($event.value)" placeholder="Any" [showClear]="true">
                                    <ng-template let-option pTemplate="item">
                                        <p-tag [value]="option.value" [severity]="getSeverity(option.label)"></p-tag>
                                    </ng-template>
                                </p-dropdown>
                            </ng-template>
                        </p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter type="boolean" field="verified"></p-columnFilter>
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-customer>
                <tr>
                    <td>
                        {{ customer.name }}
                    </td>
                    <td>
                        <img src="https://primefaces.org/cdn/primeng/images/demo/flag/flag_placeholder.png" [class]="'flag flag-' + customer.country.code" style="width: 20px" />
                        <span class="ml-1 vertical-align-middle">{{ case.title }}</span>
                    </td>
                    <td>
                        <img [alt]="customer.representative.name" src="https://primefaces.org/cdn/primeng/images/demo/avatar/{{ customer.representative.image }}" width="32" style="vertical-align: middle" />
                        <span class="ml-1 vertical-align-middle">{{ customer.representative.name }}</span>
                    </td>
                    <td>
                        <p-tag [value]="case.status" [severity]="getSeverity(case.status)"></p-tag>
                    </td>
                    <td>
                        <i class="pi" [ngClass]="{ 'text-green-500 pi-check-circle': customer.verified, 'text-red-500 pi-times-circle': !customer.verified }"></i>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="5">No customers found.</td>
                </tr>
            </ng-template>
        </p-table>
           </div>
        </ng-template > -->
        <div
            class="h-full w-full  flex justify-content-center align-items-start">
            <p-table  [rowsPerPageOptions]="[5, 10, 15]" [rows]="5" [paginator]="true"  [value]="cases"
                [tableStyle]="{ 'min-width': '50rem','width':'60rem'}">
                <ng-template pTemplate="header">
                    <tr>
                        <th class="text-center"
                            style="background-color: #962330;color: white;">TÍTULO
                            DEL CASO</th>
                        <th class="text-center"
                            style="background-color: #962330;color: white;">ASIGNATURA</th>
                        <th class="text-center"
                            style="background-color: #962330;color: white;">FECHA
                            DE CREACIÓN</th>
                        <th class="text-center"
                            style="background-color: #962330;color: white;">CAMPUS</th>
                        <th class="text-center"
                            style="background-color: #962330;color: white;">ESTADO</th>
                        <th class="text-center"
                            style="background-color: #962330;color: white;">VER</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-cases>
                    <tr>
                        <td class="text-center">{{cases.title}}</td>
                        <td  class="text-center">{{(cases.nrc.name.length>5)? (cases.nrc.name | slice:0:10)+'...':(cases.nrc.name)}}</td>
                        <td class="text-center">{{cases.createdAt | date}}</td>
                        <td class="text-center">{{cases.campus.name}}</td>
                        <td *ngIf="cases.status=='UNSOLVED'" class="text-center">En
                            espera</td>
                        <td *ngIf="cases.status=='APPROVED'" class="text-center">Aprobado</td>
                        <td *ngIf="cases.status=='REJECTED'" class="text-center">Rechazado</td>
                        <td *ngIf="cases.status=='SOLVED'" class="text-center">Resuelto</td> 
                        
                        <td class="text-center">
                            <p-button
                                styleClass="p-button-rounded p-button-secondary p-button-text "
                                icon="pi pi-eye" (onClick)="getCase(cases.id, 'VIEW')"></p-button>
                            
                            <p-button *ngIf="cases.status=='UNSOLVED' && userRole == 'VR'" 
                                styleClass="p-button-rounded p-button-secondary p-button-text"
                                icon="pi pi-pencil"
                                (onClick)="getCase(cases.id, 'EDIT')"></p-button>
                            <p-button *ngIf="cases.status=='APPROVED' && userRole == 'PROFESSOR'" 
                                styleClass="p-button-rounded p-button-secondary p-button-text"
                                icon="pi pi-pencil"
                                (onClick)="getCase(cases.id, 'EDIT')"></p-button>
                        </td>

                    </tr>
                </ng-template>
                <ng-template class="flex align-items-center justify-content-center" pTemplate="emptymessage" let-columns>
                            No hay casos
                </ng-template>
            </p-table>
        </div>

    </div>
</section>
<app-case-review (onClose)="handleClose($event)" [case]="selectedCase" [visible]="visible" [action]="selectedAction" (onUpdate)="getCases()"></app-case-review>

<!-- <p-dialog *ngIf="isLoaded==true" [header]="case.title" [(visible)]="visible" [modal]="true" [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false">

    
    <div class="flex flex-column gap-2">
        <div class="flex flex-row justify-content-between">
            <h5 class="m-0 text-gray-500">
    
                {{case.createdAt | date:"MMM dd, yyyy 'a las' hh:mm a"}}
            </h5>
            <div>
                {{case.files}}
            </div>
            

        </div>
        <p class="m-0">
            {{case.description}}
        </p>
        <h5>Estudiante: {{case.student.name}} {{case.student.surname}}</h5>
    </div>
        
    <p-divider></p-divider>
    <div *ngIf="case.response===null && userRole==='STUDENT'" class="flex align-items-center justify-content-center flex-row gap-3">
            <h3>Aún no hay respuesta</h3>
            <i class="pi pi-info-circle"></i>
    </div>
    <div *ngIf="case.response!=null" class="flex flex-column gap-2">
        <div class="flex flex-row justify-content-between">
            <h5 class="m-0 text-gray-500">
    
                {{case.respondedAt | date:"MMM dd, yyyy 'a las' hh:mm a"}}
            </h5>
            

        </div>
        <p class="m-0">
            {{case.response}}
        </p>
        <h5>Profesor: {{case.professor.name}} {{case.professor.surname}} </h5>
    </div>
</p-dialog>
<p-dialog *ngIf="isLoaded==true" [header]="case.title" [(visible)]="visibleResponse" [modal]="true" [style]="{ width: '60vw', height:'60vw'}" [draggable]="false" [resizable]="false">
    
    <div class="flex flex-column gap-2">
        <div class="flex flex-row justify-content-between">
            <h5 class="m-0 text-gray-500">
    
                {{case.createdAt | date:"MMM dd, yyyy 'a las' hh:mm a"}}
            </h5>
            <div>
                {{case.files}}
            </div>
            

        </div>
        <p class="m-0">
            {{case.description}}
        </p>
        <h5>Estudiante: {{case.student.name}} {{case.student.surname}}</h5>
    </div>
        
    <p-divider></p-divider>
    <div class="flex align-items-center justify-content-center flex-column gap-3">
        <div class="flex flex-row justify-content-between align-items-center w-full">
            <h5>Escriba su respuesta</h5>
            <div class="flex flex-row align-items-center gap-3">
                <h5>Seleccione una fecha:</h5>
                <p-calendar formControlName="date"></p-calendar>
                
            </div>
            
            <h5>Aprobado</h5>
        </div>
        <textarea rows="5" cols="30" pInputTextarea formControlName="description" [ngStyle]="{'resize':'none','width':'100%','height':'100%'}"></textarea>
    </div>
    
</p-dialog> -->